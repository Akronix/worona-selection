<!--
   client.html

   Descp:

   Created on: 21-jul-2016

   Copyright 2016 Abel 'Akronix' Serrano Juste <akronix5@gmail.com>
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
    <title>Client</title>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <script src="jquery-3.1.0.min.js"></script>
  </head>

  <body>
    <button id="all_posts_btn">All posts</button>
    <button id="gadget_posts_btn">Gadget posts</button>
    <ul id="output_list"></ul>
  </body>

  <script>


    // Adding event listener to DOM elements
    $("#all_posts_btn").click ( function(){ fetch_posts('?per_page=5')} );
    $("#gadget_posts_btn").click ( function(){ fetch_posts('?per_page=5&categories=2375')} );

    var base_url = 'https://www.govoid.es/wp-json/wp/v2/posts';
    
    $( document ).ajaxStart(function() {
      console.log('Loading');
      //~ $( "#loading" ).show();
      }).ajaxStop(function() {
        console.log('Done.');
      //~ $( "#loading" ).hide();
    });
    

    function handler( data ) {
      
      var resp = data.responseJSON
      var output_cont = document.getElementById("output_list");
      var string_out = ''

      resp.forEach(
        function(element) {
          string_out += '<li>' + (element["title"].rendered) + '</li>';
          }
      );

      output_cont.innerHTML = string_out
    }


    // Optional first argument allows to append API REST options to the endpoint URL 
    function fetch_posts() {

      var url = (arguments[0]? base_url + arguments[0] : base_url)
      
      var request = $.ajax({
        type: 'GET',
        url: url,
        dataType: "json",
      })
      request.done( handler );
      request.fail(function( jqXHR, textStatus ) {
        alert( "Request failed: " + textStatus );
      });
    }


  </script>

</html>
